<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Losin' the Plot - Annotated Lyrics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lora:wght@400;600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-dark: #000000;
            --surface-color: #201A28; 
            --text-primary: #e2e2e2;
            --text-secondary: #888888;
            --border-color: #3a2a4a; 
            --album-identity-color: #9333ea; 
            --hover-accent-color: rgba(147, 51, 234, 0.15); 
            --icon-color-light-purple: #b298dc; 
        }
        body {
            font-family: 'Lora', serif;
            background-color: var(--background-dark);
            color: var(--text-primary);
        }
        html { scroll-behavior: smooth; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--background-dark); }
        ::-webkit-scrollbar-thumb { background-color: #581c87; border-radius: 8px; border: 2px solid var(--background-dark); }
        .main-container { max-width: 768px; }
        .lyrics-header h1 {
            font-family: 'Playfair Display', serif;
            color: var(--album-identity-color);
        }
        .lyrics-line {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: background-color 0.2s ease, color 0.2s ease;
            color: var(--text-secondary);
            font-size: 1.1rem;
            line-height: 1.8;
        }
        .lyrics-line:hover {
            background-color: var(--hover-accent-color);
            color: var(--text-primary);
        }
        .lyrics-line.active {
            background-color: var(--album-identity-color);
            color: #fff;
            font-weight: 600;
        }
        .verse-title {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-top: 3rem;
            margin-bottom: 1rem;
        }
        #annotation-panel {
            background-color: var(--surface-color);
            border-left: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            max-width: 550px;
            height: 100vh;
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
            z-index: 50;
            font-family: 'Inter', sans-serif;
        }
        #annotation-panel.visible {
            transform: translateX(0);
            opacity: 1;
        }
        /* #panel-header-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--primary-accent-color);
        } */
        .annotation-content {
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-primary);
        }
        .source-lyric {
            background-color: var(--album-identity-color);
            color: #fff;
            font-weight: 600;
        }
        
        .close-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background-color: transparent;
            color: var(--icon-color-light-purple);
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .close-button:hover {
            background-color: var(--album-identity-color);
            color: #fff;
        }
        .close-button svg {
            width: 1rem;
            height: 1rem;
        }
        
        .back-button {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background-color: rgba(32, 26, 40, 0.7);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            color: var(--icon-color-light-purple);
            transition: all 0.2s ease;
            border: 1px solid var(--border-color);
        }
        .back-button:hover {
            background-color: var(--album-identity-color);
            color: #fff;
            transform: scale(1.05);
        }
        .back-button svg {
            width: 1.5rem;
            height: 1.5rem;
        }

        .about-button-expand {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            height: 2.5rem;
            padding: 0 0.75rem;
            border-radius: 999px;
            background-color: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            overflow: hidden;
        }
        .about-button-text {
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0;
            width: 0;
            transition: width 0.4s cubic-bezier(0.23, 1, 0.32, 1), opacity 0.2s ease;
        }
        .about-button-expand:hover {
            background-color: var(--surface-color);
            color: var(--text-primary);
            border-color: var(--primary-accent-color);
        }
        .about-button-expand:hover .about-button-text {
            width: 50px;
            opacity: 1;
        }

        @media (max-width: 768px) {
            .lyrics-line { font-size: 1rem; line-height: 1.7; }
            #annotation-panel {
                top: auto;
                bottom: 0;
                width: 100%;
                max-width: 100%;
                height: 60vh;
                transform: translateY(100%);
                border-left: none;
                border-top: 1px solid var(--border-color);
                border-top-left-radius: 20px;
                border-top-right-radius: 20px;
            }
            #annotation-panel.visible { transform: translateY(0); }
            .back-button { top: 1rem; left: 1rem; width: 2.5rem; height: 2.5rem; }
            .back-button svg { width: 1.25rem; height: 1.25rem; }
        }
    </style>
</head>
<body class="">
    <a href="index.html" class="back-button" aria-label="Back to main page">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
        </svg>
    </a>
        
    <div class="main-container px-6 py-12 md:px-12 md:py-24">
        <header class="lyrics-header mb-12">
            <div class="flex items-center gap-4">
                <h1 class="text-5xl md:text-6xl font-bold mb-0">losin' the plot</h1>
                <button id="about-song-button" class="about-button-expand" aria-label="About this song">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                    <span class="about-button-text">About</span>
                </button>
            </div>
            <h2 class="text-xl text-gray-400 mt-2">Annotated Lyrics</h2>
        </header>

        <section id="lyrics-content">
            <h3 class="verse-title">Verse 1</h3>
            <div id="lyrics-v1" class="space-y-1">
                <p class="lyrics-line" data-annotation-id="v1-group-1">tarhke svere 5 vje karan sama khoti</p>
                <p class="lyrics-line" data-annotation-id="v1-group-1">begaane mulkan’ch rehke khoure labhan roji</p>
                <p class="lyrics-line" data-annotation-id="v1-group-2">par labhan kakh na khud nu dassan doshi</p>
                <p class="lyrics-line" data-annotation-id="v1-group-2">paunda mai adh jaan yatnan’ch rajjan oh’ch hi</p>
                <p class="lyrics-line" data-annotation-id="v1-group-3">kyunki paseena mehenga bhaari rakhan tijora</p>
                <p class="lyrics-line" data-annotation-id="v1-group-3">khud di ghrina seh lainda aam hi laddan aarope</p>
                <p class="lyrics-line" data-annotation-id="v1-group-4">dine sutta jo rehenda raati karan dil haula</p>
                <p class="lyrics-line" data-annotation-id="v1-group-4">aidan nakaari sehenda tanhi mannan na boj</p>
                <p class="lyrics-line" data-annotation-id="v1-group-5">fal bedhyaani de te laad palle saukh de</p>
                <p class="lyrics-line" data-annotation-id="v1-group-5">aukh nu seha ni te aasaar pakke ghaul de</p>
                <p class="lyrics-line" data-annotation-id="v1-group-6">kam taleyan di ve kataar agge daurh de</p>
                <p class="lyrics-line" data-annotation-id="v1-group-6">te vart sihaayi eh vichaar panne raund de</p>
                <p class="lyrics-line" data-annotation-id="v1-group-7">mijaaz eh nave dhill taaji aa tabiyat di</p>
                <p class="lyrics-line" data-annotation-id="v1-group-7">vichaarde ne jaankaar aakhir ehdi niyat ki?</p>
                <p class="lyrics-line" data-annotation-id="v1-group-8">sach kahan tan menu vi ni andesa</p>
                <p class="lyrics-line" data-annotation-id="v1-group-8">asan gaal raye akhan agge jwaani jehri khillar rahi</p>
            </div>
            
            <h3 class="verse-title">Hook</h3>
            <div id="lyrics-hook-1" class="space-y-1">
                <p class="lyrics-line" data-annotation-id="hook-1">I’M LOSIN’ THE PLOT, lachaari kiti ghar</p>
                <p class="lyrics-line" data-annotation-id="hook-1">mere dil de verhe’ch, akal hoyi meri thap</p>
                <p class="lyrics-line" data-annotation-id="hook-1">I’M LOSIN’ THE PLOT, nhere ne dhakke saare raah</p>
                <p class="lyrics-line" data-annotation-id="hook-1">reha vass’ch ni kuch, aasre layi adhan baahn</p>
                <p class="lyrics-line" data-annotation-id="hook-1">I’M LOSIN’ THE PLOT, Narain tu hi hath pharh</p>
                <p class="lyrics-line" data-annotation-id="hook-1">meri harlai burayiaan, chit honsle naal bhar</p>
                <p class="lyrics-line" data-annotation-id="hook-1">I’M LOSIN’ THE PLOT, I’M LOSIN’ THE PLOT</p>
                <p class="lyrics-line" data-annotation-id="hook-1">I’M LOSIN’, I’M LOSIN’ THE PLOT, I’M LOSIN’ THE PLOT, I’M LOSIN’ THE</p>
            </div>

            <h3 class="verse-title">Verse 2</h3>
            <div id="lyrics-v2" class="space-y-1">
                <p class="lyrics-line" data-annotation-id="v2-group-1">sochan maapeyan di divvta de kaabil haan ki?</p>
                <p class="lyrics-line" data-annotation-id="v2-group-1">ohna de khate lakhan punan’ch mai shaamil aa ki?</p>
                <p class="lyrics-line" data-annotation-id="v2-group-2">karman de khaate chadhiyan himaaqatan kai</p>
                <p class="lyrics-line" data-annotation-id="v2-group-2">sooli chadheya mai takaat di laalsa di</p>
                <p class="lyrics-line" data-annotation-id="v2-group-3">ulambheyan de thapper naal dhaleya aakaar</p>
                <p class="lyrics-line" data-annotation-id="v2-group-3">kala di nipunta’ch labheya jwaab</p>
                <p class="lyrics-line" data-annotation-id="v2-group-4">jyaada eerkha te ghat sikhne da chaah</p>
                <p class="lyrics-line" data-annotation-id="v2-group-4">tan hi sraapiya kyunki mai thageya gyaan</p>
                <p class="lyrics-line" data-annotation-id="v2-group-5">dhakkda rawaiyya ban kavach insecurities</p>
                <p class="lyrics-line" data-annotation-id="v2-group-5">yogta nu ravi diyan kirnan na paunchdi</p>
                <p class="lyrics-line" data-annotation-id="v2-group-6">Kishan lubhaunda menu dharam val</p>
                <p class="lyrics-line" data-annotation-id="v2-group-6">chutde na aeib maarhe par jiddan yaari duryodhan di</p>
                <p class="lyrics-line" data-annotation-id="v2-group-7">hankaar’ch ve rajjeya te saarhe da mai khaada</p>
                <p class="lyrics-line" data-annotation-id="v2-group-7">maidaane aj tanj mai gwaale de sahaaran</p>
                <p class="lyrics-line" data-annotation-id="v2-group-8">nihatha godhe-bhaar, baundleya te vechaara</p>
                <p class="lyrics-line" data-annotation-id="v2-group-8">teer-taani kharha Arjan, hataash ho vichaaran</p>
            </div>
            
            <h3 class="verse-title">Hook</h3>
            <div id="lyrics-hook-2" class="space-y-1">
                <p class="lyrics-line" data-annotation-id="hook-2">I’M LOSIN’ THE PLOT, lachaari kiti ghar</p>
                <p class="lyrics-line" data-annotation-id="hook-2">mere dil de verhe’ch, akal hoyi meri thap</p>
                <p class="lyrics-line" data-annotation-id="hook-2">I’M LOSIN’ THE PLOT, nhere ne dhakke saare raah</p>
                <p class="lyrics-line" data-annotation-id="hook-2">reha vass’ch ni kuch, aasre layi adhan baahn</p>
                <p class="lyrics-line" data-annotation-id="hook-2">I’M LOSIN’ THE PLOT, Narain tu hi hath pharh</p>
                <p class="lyrics-line" data-annotation-id="hook-2">meri harlai burayiaan, chit honsle naal bhar</p>
                <p class="lyrics-line" data-annotation-id="hook-2">I’M LOSIN’ THE PLOT, I’M LOSIN’ THE PLOT</p>
                <p class="lyrics-line" data-annotation-id="hook-2">I’M LOSIN’, I’M LOSIN’ THE PLOT, I’M LOSIN’ THE PLOT, I’M LOSIN’ THE</p>
            </div>
        </section>
    </div>

    <aside id="annotation-panel" class="flex flex-col">
        <header class="p-4 border-b flex items-center justify-between" style="border-color: var(--border-color);">
            <div id="panel-header-content" class="flex-grow mr-4">
            </div>
            <button id="close-annotation" class="close-button flex-shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </header>
        <div id="annotation-content-area" class="annotation-content">
        </div>
    </aside>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
             const annotations = { "v1-group-1": "Anshul confesses to wasting time at 5 AM while in 'foreign lands' possibly searching for a livelihood. This highlights his struggle with laziness and self-sabotage, echoing themes from other songs where he admits that 'due to laziness, he ruins his life, and wastes opportunities' (aitbaar) and 'actively mutilates his own legs' (loser). This inaction contributes to his feeling of being 'imprisoned' ('KAID') by his own indecision and 'shapeless dreams' ('aakaarheen').", "v1-group-2": "Anshul admits he 'finds nothing' in his search and immediately blames himself, a recurring theme of self-condemnation. He also confesses to making only 'half-hearted efforts' but being 'satisfied with just that,' revealing a pattern of laziness and self-sabotage. This reinforces his feeling of being 'imprisoned' ('KAID') by his own struggles.", "v1-group-3": "Anshul explains his inaction by stating that 'sweat is expensive, so he keeps a heavy treasury,' implying he hoards his effort due to laziness. He further reveals he 'usually endures his own hatred and takes on accusations,' highlighting his pervasive self-blame and self-loathing. This internal struggle reinforces his feeling of being 'imprisoned' ('KAID') by his inaction and self-condemnation.", "v1-group-4": "Anshul confesses to sleeping during the day, a direct sign of his laziness and self-sabotage. He then lightens his heart at night, possibly through songwriting, a key coping mechanism. Paradoxically, he endures his incompetence and no longer perceives it as a burden, highlighting a dangerous resignation to his self-defeating patterns.", "v1-group-5": "Anshul observes that positive results are ignored due to his inattentiveness, while he cherishes comfort and ease. He further admits to avoiding hardship, leading to clear signs of indolence. This inaction, driven by comfort-seeking, reinforces his 'imprisonment' ('KAID') by internal struggles, hindering his 'shapeless dreams' ('aakaarheen').", "v1-group-6": "Anshul confesses that he is 'running from the delayed tasks that have now piled up.' To cope, he 'uses ink to roll these thoughts over pages.' This highlights his laziness and self-sabotage, while demonstrating songwriting as his primary coping mechanism, offering a paradoxical liberation from his 'imprisonment in thoughts' ('KAID').", "v1-group-7": "Anshul observes that a new form of sluggishness has settled into his disposition. Consequently, those familiar with him are now pondering his ultimate intentions. This external scrutiny, combined with his deepening laziness, contributes to his feeling of being 'lost, stuck, and uncertain' and reinforces his emotional 'imprisonment' ('KAID').", "v1-group-8": "Anshul candidly admits that 'truthfully, even he has no clear understanding or insight' into his own direction. He laments that 'his youth is being wasted away and is disintegrating right before his eyes.' This highlights the decay of his prime years due to laziness and self-sabotage, reinforcing his emotional 'imprisonment' ('KAID') by his own lack of defined purpose.", "hook-1": "Anshul's repeated declaration of 'I’M LOSIN’ THE PLOT' signifies an escalating state of mental disorientation and loss of direction. He reveals 'helplessness has made a home in the courtyard of his heart,' with his 'mind stopped working' and 'all possible paths covered with darkness.' Desperate, he 'extends his arm for support,' making a direct plea to the divine, 'Narain, you hold my hand,' asking for his 'bad habits to be taken away' and his 'heart to be filled with courage.' This powerfully captures his emotional 'imprisonment' ('KAID') by his own mind and self-sabotaging inaction.", "v2-group-1": "<strong>Anshul's Interpretation:</strong> He grapples with deep insecurity and self-blame, questioning, 'I wonder if I am worthy of my parents' divinity?' and 'Am I included in their millions of good deeds?' He reflects on whether his current state makes him a worthy reflection of his parents' virtues. This internal scrutiny fuels his emotional 'imprisonment' ('KAID') by his own conscience.<br><br><strong>Karna's Parallel:</strong> These lines draw a parallel to Karna's life, who, born of divine lineage but raised by a charioteer, would often question his true worthiness and whether his deeds truly honored his divine parents.", "v2-group-2": "<strong>Anshul's Interpretation:</strong> He states 'many mistakes and foolish actions have accumulated in his deeds,' and he has 'suffered greatly, driven by a craving for power or influence.' This refers to his self-sabotaging choices and pursuit of external validation which have fueled his suffering and emotional 'KAID' (imprisonment).<br><br><strong>Karna's Parallel:</strong> His life was marked by choices stemming from a fierce desire for status and recognition, which ultimately led to his tragic downfall and immense suffering in the Mahabharata.", "v2-group-3": "<strong>Anshul's Interpretation:</strong> He acknowledges that external judgments ('ulambheyan' - taunts) profoundly molded his self-perception. His art, particularly rap, became his primary coping mechanism and source of liberation from this emotional 'KAID' (imprisonment), allowing him to find direction amidst his 'shapeless dreams' ('aakaarheen').<br><br><strong>Karna's Parallel:</strong> Karna's identity was profoundly shaped by constant taunts about his perceived low birth. He asserted his worth and found his 'answer' and validation through his unparalleled skill and excellence in weaponry, particularly as an archer.", "v2-group-4": "<strong>Anshul's Interpretation:</strong> He harbored 'more envy and less desire to learn,' leading him to be 'cursed' by his own self-sabotage (envy, laziness, stubbornness). This internal 'curse' reinforces his emotional 'KAID' (imprisonment) and contributes to his 'shapeless dreams' ('aakaarheen').<br><br><strong>Karna's Parallel:</strong> Karna's intense envy of Arjuna led him to deceive his guru, Parashurama, to acquire knowledge. When discovered, Parashurama cursed him to forget this vital knowledge at the moment he needed it most, a direct consequence of his deception ('thageya gyaan').", "v2-group-5": "<strong>Anshul's Interpretation:</strong> His 'defensive attitude acts as a shield for his insecurities,' masking his inner turmoil. Despite his artistic talent, his true worth goes unrecognized due to self-sabotage, fostering 'shapeless dreams' ('aakaarheen') and contributing to his emotional 'KAID' (imprisonment).<br><br><strong>Karna's Parallel:</strong> Karna possessed a literal, divine shield ('kavach') from birth. This also served as a metaphorical shield for his deep insecurities about his lineage. Despite his immense competence and divine connection to the Sun god ('Ravi'), his true merit often remained unrecognized.", "v2-group-6": "<strong>Anshul's Interpretation:</strong> He feels a pull towards righteousness ('Kishan entices me') but confesses, 'bad habits do not leave me.' These detrimental patterns, like laziness, are as deeply ingrained and difficult to abandon as Karna's destructive loyalty to Duryodhana, keeping him 'imprisoned' ('KAID').<br><br><strong>Karna's Parallel:</strong> Krishna (Kishan) sought to guide Karna towards a righteous path. However, Karna's profound loyalty to the unrighteous Duryodhana was a fundamental flaw he could not relinquish, paralleling Anshul's own deep-seated bad habits.", "v2-group-7": "<strong>Anshul's Feeling:</strong> He uses Karna's experience as a metaphor for being so consumed by internal 'monsters' like pride and envy that he struggles to accept guidance and remains trapped in self-destructive patterns.<br><br><strong>Karna's Reference:</strong> Karna was 'full of arrogance and consumed by jealousy.' During his final duel, Krishna (the 'Gwaala' or cowherd) rebuked him with reminders of his misdeeds, a moment of critical judgment Karna was forced to tolerate, highlighting his tragic downfall.", "v2-group-8": "<strong>Anshul's Feeling:</strong> He conveys his own feeling of 'losing the plot' through Karna's predicament—being utterly disarmed, helpless, and bewildered by his own inaction, as if cursed to forget how to move forward.<br><br><strong>Karna's Reference:</strong> This describes Karna's tragic climax: 'disarmed, kneeling, bewildered, and helpless' as his chariot wheel got stuck. His confusion was amplified by Parashurama's curse, which made him forget his knowledge of weaponry. In despair, he contemplates this catastrophic loss, serving as the ultimate metaphor for 'losing the plot.'", "hook-2": "The Hook repeatedly declares, 'I’M LOSIN’ THE PLOT,' signifying a profound loss of direction. <strong>For Anshul:</strong> His intellect is paralyzed by helplessness and self-sabotaging habits, leaving him lost as he pleads, 'Narain, hold my hand.' <strong>For Karna:</strong> This is his tragic culmination, where he is disarmed, kneeling, bewildered, and contemplating in despair. His intellect is paralyzed, leading to an implicit yearning for divine mercy despite his earlier rejection of Krishna's counsel." };

            const aboutSongButton = document.getElementById('about-song-button');
            const lyricsLines = document.querySelectorAll('.lyrics-line');
            const annotationPanel = document.getElementById('annotation-panel');
            const panelHeaderContent = document.getElementById('panel-header-content');
            const annotationContentArea = document.getElementById('annotation-content-area');
            const closeButton = document.getElementById('close-annotation');
            let activeAnnotationId = null;
            let currentPanelState = null;

            const aboutSongText = `
                <p class="mb-4">All battles end. In "losin’ the plot," the artist's inner war culminates in a devastating surrender. To articulate this collapse, Anshul reframes his modern breakdown through the ancient tragedy of the warrior Karna. He sees himself in the doomed hero—his potential "cursed" by his own envy, his progress undone by a fatal loyalty to his "bad habits". The song culminates in that devastating final image: a warrior, "disarmed, kneeling, bewildered, and helpless," finally losing the plot on the battlefield of his own mind.</p>
            `;

            function showAboutContent() {
                panelHeaderContent.innerHTML = `<h2 id="panel-header-title">About 'losin' the plot'</h2>`;
                annotationContentArea.innerHTML = `<div class="p-6">${aboutSongText}</div>`;
                if (activeAnnotationId) {
                    document.querySelectorAll(`[data-annotation-id='${activeAnnotationId}'].active`).forEach(el => el.classList.remove('active'));
                    activeAnnotationId = null;
                }
                currentPanelState = 'about';
                annotationPanel.classList.add('visible');
            }

            function showAnnotationContent(lineElement) {
                const annotationId = lineElement.getAttribute('data-annotation-id');
                if (activeAnnotationId) {
                    document.querySelectorAll(`[data-annotation-id='${activeAnnotationId}'].active`).forEach(el => el.classList.remove('active'));
                }
                document.querySelectorAll(`[data-annotation-id='${annotationId}']`).forEach(el => el.classList.add('active'));
                activeAnnotationId = annotationId;

                const annotationText = annotations[annotationId] || "No annotation for this line.";
                const groupElements = lineElement.parentElement.querySelectorAll(`[data-annotation-id='${annotationId}']`);
                const sourceText = Array.from(groupElements).map(el => el.innerHTML).join('<br>');

                panelHeaderContent.innerHTML = `<p class="source-lyric p-3 rounded-lg text-sm">${sourceText}</p>`;
                annotationContentArea.innerHTML = `<div class="p-6">${annotationText}</div>`;
                currentPanelState = 'annotation';
                annotationPanel.classList.add('visible');
            }

            function closeAnnotationPanel() {
                if (activeAnnotationId) {
                    document.querySelectorAll(`[data-annotation-id='${activeAnnotationId}'].active`).forEach(el => el.classList.remove('active'));
                    activeAnnotationId = null;
                }
                annotationPanel.classList.remove('visible');
                currentPanelState = null;
            }

            aboutSongButton.addEventListener('click', (e) => {
                e.stopPropagation();
                if (annotationPanel.classList.contains('visible') && currentPanelState === 'about') {
                    closeAnnotationPanel();
                } else {
                    showAboutContent();
                }
            });

            lyricsLines.forEach(line => {
                line.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const clickedAnnotationId = line.getAttribute('data-annotation-id');
                    if (clickedAnnotationId === activeAnnotationId) {
                        closeAnnotationPanel();
                    } else {
                        showAnnotationContent(line);
                    }
                });
            });

            closeButton.addEventListener('click', (e) => {
                e.stopPropagation();
                closeAnnotationPanel();
            });

            document.body.addEventListener('click', (e) => {
                if (annotationPanel.classList.contains('visible') && !annotationPanel.contains(e.target) && !aboutSongButton.contains(e.target)) {
                    closeAnnotationPanel();
                }
            });
        });
    </script>
</body>
</html>